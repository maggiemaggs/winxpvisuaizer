<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Windows Media Player - Battery & Alchemy</title>
    <link rel="stylesheet" href="https://unpkg.com/xp.css" />
    <script crossorigin src="https://unpkg.com/react@18/umd/react.production.min.js"></script>
    <script crossorigin src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"></script>
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        body {
            margin: 0;
            padding: 0;
            background-image: url('https://ia601200.us.archive.org/11/items/theoriginalfilesofsomewindowswallpapers/bliss%20600dpi.jpg');
            background-size: cover;
            background-position: center;
            background-attachment: fixed;
            font-family: 'Tahoma', sans-serif;
        }
        
        .xp-window {
            width: 100%;
            max-width: 900px;
            margin: 0 auto;
        }
        
        .window-body-custom {
            padding: 0;
            margin: 0;
        }
        
        .viz-controls {
            background: linear-gradient(180deg, #ECE9D8 0%, #E3DED0 100%);
            padding: 12px;
            border-top: 1px solid #fff;
        }
        
        .viz-select {
            font-family: 'Tahoma', sans-serif;
            font-size: 11px;
            padding: 2px 4px;
        }
        
        .control-button {
            background: linear-gradient(180deg, #ECE9D8 0%, #D6D3CE 100%);
            border: 1px solid #003C74;
            padding: 4px 8px;
            cursor: pointer;
            font-size: 11px;
            font-family: 'Tahoma', sans-serif;
        }
        
        .control-button:hover {
            background: linear-gradient(180deg, #F0EDE4 0%, #DEDAD2 100%);
        }
        
        .control-button:active {
            background: linear-gradient(180deg, #D6D3CE 0%, #ECE9D8 100%);
        }
        
        input[type="text"].xp-input {
            border: 1px solid #7F9DB9;
            padding: 3px 4px;
            font-family: 'Tahoma', sans-serif;
            font-size: 11px;
            background: white;
        }
        
        input[type="text"].xp-input:focus {
            outline: 1px solid #0078D7;
        }
        
        .status-text {
            font-size: 11px;
            font-family: 'Tahoma', sans-serif;
            padding: 4px 0;
        }
    </style>
</head>
<body>
    <div id="root"></div>
    
    <script type="text/babel">
        const { useState, useEffect, useRef } = React;
        
        // Lucide icons as inline SVG components
        const Play = ({ size = 16 }) => (
            <svg width={size} height={size} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round">
                <polygon points="5 3 19 12 5 21 5 3"></polygon>
            </svg>
        );
        
        const Pause = ({ size = 16 }) => (
            <svg width={size} height={size} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round">
                <rect x="6" y="4" width="4" height="16"></rect>
                <rect x="14" y="4" width="4" height="16"></rect>
            </svg>
        );
        
        const Volume2 = ({ size = 16 }) => (
            <svg width={size} height={size} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round">
                <polygon points="11 5 6 9 2 9 2 15 6 15 11 19 11 5"></polygon>
                <path d="M19.07 4.93a10 10 0 0 1 0 14.14M15.54 8.46a5 5 0 0 1 0 7.07"></path>
            </svg>
        );

        const SkipBack = ({ size = 16 }) => (
            <svg width={size} height={size} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round">
                <polygon points="19 20 9 12 19 4 19 20"></polygon>
                <line x1="5" y1="19" x2="5" y2="5"></line>
            </svg>
        );

        const SkipForward = ({ size = 16 }) => (
            <svg width={size} height={size} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round">
                <polygon points="5 4 15 12 5 20 5 4"></polygon>
                <line x1="19" y1="5" x2="19" y2="19"></line>
            </svg>
        );

        const WinXPVisualizer = () => {
            const [isPlaying, setIsPlaying] = useState(false);
            const [currentViz, setCurrentViz] = useState('battery-chemicalnova');
            const [volume, setVolume] = useState(70);
            const [audioSrc, setAudioSrc] = useState('https://www.soundhelix.com/examples/mp3/SoundHelix-Song-1.mp3');
            const [trackName, setTrackName] = useState('Demo Track');
            const [urlInput, setUrlInput] = useState('');
            const [loadingStatus, setLoadingStatus] = useState('');
            const canvasRef = useRef(null);
            const feedbackCanvasRef = useRef(null);
            const audioRef = useRef(null);
            const animationRef = useRef(null);
            const analyserRef = useRef(null);
            const audioContextRef = useRef(null);
            const fileInputRef = useRef(null);
            const timeRef = useRef(0);
            const particlesRef = useRef([]);

            useEffect(() => {
                const canvas = canvasRef.current;
                const ctx = canvas.getContext('2d');
                const feedbackCanvas = feedbackCanvasRef.current;
                const feedbackCtx = feedbackCanvas.getContext('2d');
                
                const draw = () => {
                    const width = canvas.width;
                    const height = canvas.height;
                    timeRef.current += 0.016;
                    
                    ctx.fillStyle = '#000000';
                    ctx.fillRect(0, 0, width, height);
                    
                    if (analyserRef.current && isPlaying) {
                        const bufferLength = analyserRef.current.frequencyBinCount;
                        const dataArray = new Uint8Array(bufferLength);
                        analyserRef.current.getByteFrequencyData(dataArray);
                        
                        if (currentViz.startsWith('battery-')) {
                            drawBattery(ctx, feedbackCtx, dataArray, width, height, currentViz);
                        } else if (currentViz.startsWith('alchemy-')) {
                            drawAlchemy(ctx, dataArray, width, height, currentViz);
                        }
                    } else {
                        drawIdle(ctx, width, height);
                    }
                    
                    animationRef.current = requestAnimationFrame(draw);
                };
                
                draw();
                
                return () => {
                    if (animationRef.current) {
                        cancelAnimationFrame(animationRef.current);
                    }
                };
            }, [isPlaying, currentViz]);

            // Battery visualization with video feedback effect
            const drawBattery = (ctx, feedbackCtx, dataArray, width, height, preset) => {
                const avg = dataArray.reduce((a, b) => a + b, 0) / dataArray.length / 255;
                
                const colors = getBatteryColors(preset);
                
                if (feedbackCtx.canvas.width !== width) {
                    feedbackCtx.canvas.width = width;
                    feedbackCtx.canvas.height = height;
                }
                
                feedbackCtx.drawImage(ctx.canvas, 0, 0);
                
                ctx.globalAlpha = 0.92;
                const displacement = 2 + avg * 3;
                const angle = timeRef.current * 0.5;
                const dx = Math.cos(angle) * displacement;
                const dy = Math.sin(angle) * displacement;
                ctx.drawImage(feedbackCtx.canvas, dx, dy, width, height);
                ctx.globalAlpha = 1.0;
                
                const numCurves = preset.includes('lotus') || preset.includes('cottonstar') ? 8 : 12;
                
                for (let c = 0; c < numCurves; c++) {
                    const freqBand = Math.floor((c / numCurves) * dataArray.length);
                    const intensity = dataArray[freqBand] / 255;
                    
                    ctx.beginPath();
                    ctx.lineWidth = 1 + intensity * 2;
                    
                    const hue = colors.hue + c * (360 / numCurves);
                    ctx.strokeStyle = `hsla(${hue % 360}, ${colors.saturation}%, ${colors.lightness}%, ${0.6 + intensity * 0.4})`;
                    
                    const centerX = width / 2;
                    const centerY = height / 2;
                    const radius = 100 + avg * 150;
                    
                    for (let i = 0; i <= 360; i += 5) {
                        const rad = (i + timeRef.current * 20 + c * 30) * Math.PI / 180;
                        const freqIdx = Math.floor((i / 360) * dataArray.length);
                        const value = dataArray[freqIdx] / 255;
                        
                        const r = radius + Math.sin(rad * 3 + timeRef.current + c) * 30 * value;
                        const x = centerX + Math.cos(rad) * r;
                        const y = centerY + Math.sin(rad) * r;
                        
                        if (i === 0) {
                            ctx.moveTo(x, y);
                        } else {
                            ctx.lineTo(x, y);
                        }
                    }
                    
                    ctx.closePath();
                    ctx.stroke();
                }
                
                if (preset.includes('brightsphere') || preset.includes('sleepyspray')) {
                    drawDotPlane(ctx, dataArray, width, height, colors);
                }
            };

            const drawDotPlane = (ctx, dataArray, width, height, colors) => {
                const gridSize = 20;
                const avg = dataArray.reduce((a, b) => a + b, 0) / dataArray.length / 255;
                
                for (let x = 0; x < width; x += gridSize) {
                    for (let y = 0; y < height; y += gridSize) {
                        const dx = x - width / 2;
                        const dy = y - height / 2;
                        const dist = Math.sqrt(dx * dx + dy * dy);
                        const angle = Math.atan2(dy, dx);
                        
                        const freqIdx = Math.floor(((angle + Math.PI) / (Math.PI * 2)) * dataArray.length);
                        const value = dataArray[freqIdx] / 255;
                        
                        const size = 1 + value * 4 * avg;
                        const offsetX = Math.cos(timeRef.current + dist * 0.01) * 5 * avg;
                        const offsetY = Math.sin(timeRef.current + dist * 0.01) * 5 * avg;
                        
                        ctx.fillStyle = `hsla(${colors.hue}, ${colors.saturation}%, ${colors.lightness}%, ${value * 0.7})`;
                        ctx.beginPath();
                        ctx.arc(x + offsetX, y + offsetY, size, 0, Math.PI * 2);
                        ctx.fill();
                    }
                }
            };

            const getBatteryColors = (preset) => {
                const colorSchemes = {
                    'battery-chemicalnova': { hue: 280, saturation: 90, lightness: 60 },
                    'battery-lotus': { hue: 320, saturation: 85, lightness: 55 },
                    'battery-cottonstar': { hue: 180, saturation: 70, lightness: 60 },
                    'battery-gemstonematrix': { hue: 200, saturation: 80, lightness: 50 },
                    'battery-sepiaswirl': { hue: 30, saturation: 60, lightness: 40 },
                    'battery-brightsphere': { hue: 50, saturation: 100, lightness: 60 },
                    'battery-sleepyspray': { hue: 220, saturation: 70, lightness: 50 },
                };
                return colorSchemes[preset] || { hue: 280, saturation: 80, lightness: 60 };
            };

            const drawAlchemy = (ctx, dataArray, width, height, preset) => {
                const avg = dataArray.reduce((a, b) => a + b, 0) / dataArray.length / 255;
                
                const lowFreq = dataArray.slice(0, 20).reduce((a, b) => a + b, 0) / 20;
                const midFreq = dataArray.slice(20, 60).reduce((a, b) => a + b, 0) / 40;
                const highFreq = dataArray.slice(60, 100).reduce((a, b) => a + b, 0) / 40;
                
                const rotation = timeRef.current + (midFreq - lowFreq) * 0.01;
                const spiralSpeed = (highFreq - lowFreq) * 0.001;
                
                const colors = getAlchemyColors(preset);
                
                const gradient = ctx.createRadialGradient(width/2, height/2, 0, width/2, height/2, width/2);
                gradient.addColorStop(0, `hsla(${colors.hue}, ${colors.saturation}%, 20%, 0.1)`);
                gradient.addColorStop(1, 'rgba(0, 0, 0, 0.3)');
                ctx.fillStyle = gradient;
                ctx.fillRect(0, 0, width, height);
                
                if (particlesRef.current.length < 200) {
                    for (let i = particlesRef.current.length; i < 200; i++) {
                        particlesRef.current.push({
                            angle: Math.random() * Math.PI * 2,
                            radius: Math.random() * 200,
                            speed: 0.5 + Math.random() * 1.5,
                            size: 1 + Math.random() * 2
                        });
                    }
                }
                
                particlesRef.current.forEach((p, i) => {
                    const freqIdx = Math.floor((i / particlesRef.current.length) * dataArray.length);
                    const intensity = dataArray[freqIdx] / 255;
                    
                    p.angle += p.speed * 0.01 + spiralSpeed;
                    p.radius += intensity * 2 - 0.5;
                    
                    if (p.radius < 0 || p.radius > Math.max(width, height)) {
                        p.radius = Math.random() * 100;
                        p.angle = Math.random() * Math.PI * 2;
                    }
                    
                    const x = width/2 + Math.cos(p.angle + rotation) * p.radius;
                    const y = height/2 + Math.sin(p.angle + rotation) * p.radius;
                    
                    const hue = (colors.hue + p.angle * 50 + timeRef.current * 20) % 360;
                    ctx.fillStyle = `hsla(${hue}, ${colors.saturation}%, ${colors.lightness}%, ${intensity * 0.8})`;
                    ctx.shadowBlur = 10 + intensity * 10;
                    ctx.shadowColor = `hsla(${hue}, ${colors.saturation}%, ${colors.lightness}%, ${intensity})`;
                    
                    ctx.beginPath();
                    ctx.arc(x, y, p.size * (1 + intensity), 0, Math.PI * 2);
                    ctx.fill();
                });
                
                ctx.shadowBlur = 0;
                
                ctx.globalAlpha = 0.3;
                for (let i = 0; i < 6; i++) {
                    ctx.beginPath();
                    ctx.strokeStyle = `hsla(${(colors.hue + i * 60) % 360}, ${colors.saturation}%, ${colors.lightness}%, 0.5)`;
                    ctx.lineWidth = 1;
                    
                    for (let t = 0; t < Math.PI * 2; t += 0.1) {
                        const freqIdx = Math.floor((t / (Math.PI * 2)) * dataArray.length);
                        const intensity = dataArray[freqIdx] / 255;
                        
                        const r = 150 + Math.sin(t * 3 + timeRef.current + i) * 50 * intensity;
                        const x = width/2 + Math.cos(t + rotation) * r;
                        const y = height/2 + Math.sin(t + rotation) * r;
                        
                        if (t === 0) {
                            ctx.moveTo(x, y);
                        } else {
                            ctx.lineTo(x, y);
                        }
                    }
                    
                    ctx.closePath();
                    ctx.stroke();
                }
                ctx.globalAlpha = 1.0;
            };

            const getAlchemyColors = (preset) => {
                const colorSchemes = {
                    'alchemy-random': { hue: (timeRef.current * 10) % 360, saturation: 80, lightness: 60 },
                    'alchemy-classic': { hue: 200, saturation: 70, lightness: 55 },
                    'alchemy-water': { hue: 190, saturation: 75, lightness: 60 },
                    'alchemy-fire': { hue: 15, saturation: 90, lightness: 55 },
                    'alchemy-plasma': { hue: 280, saturation: 85, lightness: 60 },
                };
                return colorSchemes[preset] || { hue: 200, saturation: 75, lightness: 60 };
            };

            const drawIdle = (ctx, width, height) => {
                const time = Date.now() * 0.001;
                
                if (currentViz.startsWith('battery-')) {
                    ctx.strokeStyle = 'rgba(100, 100, 150, 0.2)';
                    ctx.lineWidth = 1;
                    ctx.beginPath();
                    const centerX = width / 2;
                    const centerY = height / 2;
                    const radius = 100;
                    for (let i = 0; i <= 360; i += 5) {
                        const rad = i * Math.PI / 180;
                        const x = centerX + Math.cos(rad) * radius;
                        const y = centerY + Math.sin(rad) * radius;
                        if (i === 0) ctx.moveTo(x, y);
                        else ctx.lineTo(x, y);
                    }
                    ctx.stroke();
                } else {
                    for (let i = 0; i < 50; i++) {
                        const angle = (i / 50) * Math.PI * 2 + time * 0.5;
                        const r = 100 + Math.sin(time + i * 0.5) * 20;
                        const x = width/2 + Math.cos(angle) * r;
                        const y = height/2 + Math.sin(angle) * r;
                        ctx.fillStyle = `hsla(${(i * 7 + time * 50) % 360}, 70%, 60%, 0.1)`;
                        ctx.beginPath();
                        ctx.arc(x, y, 2, 0, Math.PI * 2);
                        ctx.fill();
                    }
                }
            };

            const togglePlay = async () => {
                const audio = audioRef.current;
                
                if (!audioContextRef.current) {
                    audioContextRef.current = new (window.AudioContext || window.webkitAudioContext)();
                    analyserRef.current = audioContextRef.current.createAnalyser();
                    analyserRef.current.fftSize = 512;
                    analyserRef.current.smoothingTimeConstant = 0.8;
                    
                    const source = audioContextRef.current.createMediaElementSource(audio);
                    source.connect(analyserRef.current);
                    analyserRef.current.connect(audioContextRef.current.destination);
                }
                
                if (isPlaying) {
                    audio.pause();
                } else {
                    await audio.play();
                }
                setIsPlaying(!isPlaying);
            };

            const handleVolumeChange = (e) => {
                const val = parseInt(e.target.value);
                setVolume(val);
                if (audioRef.current) {
                    audioRef.current.volume = val / 100;
                }
            };

            const handleUrlSubmit = () => {
                if (urlInput.trim()) {
                    setLoadingStatus('Loading...');
                    const audio = audioRef.current;
                    
                    if (isPlaying) {
                        audio.pause();
                        setIsPlaying(false);
                    }
                    
                    setAudioSrc(urlInput.trim());
                    const filename = urlInput.split('/').pop().split('?')[0];
                    setTrackName(filename.replace(/\.[^/.]+$/, '') || 'Custom Track');
                    
                    audio.onloadeddata = () => {
                        setLoadingStatus('‚úì Loaded successfully!');
                        setTimeout(() => setLoadingStatus(''), 3000);
                        audio.volume = volume / 100;
                    };
                    
                    audio.onerror = () => {
                        setLoadingStatus('‚úó CORS Error: Try soundhelix.com URLs or use a local file.');
                        setTimeout(() => setLoadingStatus(''), 6000);
                    };
                    
                    audio.load();
                    setUrlInput('');
                }
            };

            const handleFileUpload = (e) => {
                const file = e.target.files?.[0];
                
                if (file) {
                    const audio = audioRef.current;
                    
                    if (isPlaying) {
                        audio.pause();
                        setIsPlaying(false);
                    }
                    
                    const url = URL.createObjectURL(file);
                    setAudioSrc(url);
                    setTrackName(file.name.replace(/\.[^/.]+$/, ''));
                    
                    audio.load();
                    audio.volume = volume / 100;
                    
                    setLoadingStatus('‚úì File loaded!');
                    setTimeout(() => setLoadingStatus(''), 3000);
                    
                    e.target.value = '';
                }
            };

            return (
                <div style={{ minHeight: '100vh', display: 'flex', alignItems: 'center', justifyContent: 'center', padding: '20px' }}>
                    <div className="window xp-window">
                        <div className="title-bar">
                            <div className="title-bar-text">Windows Media Player</div>
                            <div className="title-bar-controls">
                                <button aria-label="Minimize"></button>
                                <button aria-label="Maximize"></button>
                                <button aria-label="Close"></button>
                            </div>
                        </div>
                        
                        <div className="window-body window-body-custom">
                            <div style={{ backgroundColor: '#000', position: 'relative' }}>
                                <canvas ref={canvasRef} width={900} height={450} style={{ width: '100%', display: 'block' }} />
                                <canvas ref={feedbackCanvasRef} width={900} height={450} style={{ display: 'none' }} />
                            </div>
                            
                            <div className="viz-controls">
                                <div style={{ marginBottom: '10px', display: 'flex', alignItems: 'center', gap: '8px' }}>
                                    <label style={{ fontSize: '11px' }}>Visualization:</label>
                                    <select
                                        value={currentViz}
                                        onChange={(e) => {
                                            setCurrentViz(e.target.value);
                                            particlesRef.current = [];
                                        }}
                                        className="viz-select"
                                    >
                                        <optgroup label="Battery">
                                            <option value="battery-chemicalnova">chemicalnova</option>
                                            <option value="battery-lotus">lotus</option>
                                            <option value="battery-cottonstar">cottonstar</option>
                                            <option value="battery-gemstonematrix">gemstonematrix</option>
                                            <option value="battery-sepiaswirl">sepiaswirl</option>
                                            <option value="battery-brightsphere">brightsphere</option>
                                            <option value="battery-sleepyspray">sleepyspray</option>
                                        </optgroup>
                                        <optgroup label="Alchemy">
                                            <option value="alchemy-random">Random</option>
                                            <option value="alchemy-classic">Classic</option>
                                            <option value="alchemy-water">Water</option>
                                            <option value="alchemy-fire">Fire</option>
                                            <option value="alchemy-plasma">Plasma</option>
                                        </optgroup>
                                    </select>
                                </div>
                                
                                <div style={{ marginBottom: '10px', display: 'flex', alignItems: 'center', justifyContent: 'space-between' }}>
                                    <div style={{ display: 'flex', gap: '6px' }}>
                                        <button className="control-button" title="Previous">
                                            <SkipBack />
                                        </button>
                                        <button onClick={togglePlay} className="control-button" style={{ padding: '6px 12px' }}>
                                            {isPlaying ? <Pause /> : <Play />}
                                        </button>
                                        <button className="control-button" title="Next">
                                            <SkipForward />
                                        </button>
                                    </div>
                                    
                                    <div style={{ display: 'flex', alignItems: 'center', gap: '6px' }}>
                                        <Volume2 />
                                        <input type="range" min="0" max="100" value={volume} onChange={handleVolumeChange} style={{ width: '100px' }} />
                                        <span style={{ fontSize: '11px', width: '35px', textAlign: 'right' }}>{volume}%</span>
                                    </div>
                                </div>
                                
                                <div style={{ marginBottom: '8px' }}>
                                    <div style={{ display: 'flex', gap: '4px', marginBottom: '4px' }}>
                                        <input
                                            type="text"
                                            value={urlInput}
                                            onChange={(e) => setUrlInput(e.target.value)}
                                            onKeyPress={(e) => e.key === 'Enter' && handleUrlSubmit()}
                                            placeholder="Enter MP3 URL..."
                                            className="xp-input"
                                            style={{ flex: 1 }}
                                        />
                                        <button onClick={handleUrlSubmit} className="control-button">
                                            Load URL
                                        </button>
                                    </div>
                                    
                                    <div style={{ display: 'flex', gap: '4px' }}>
                                        <input ref={fileInputRef} type="file" accept="audio/*" onChange={handleFileUpload} style={{ display: 'none' }} />
                                        <button onClick={() => fileInputRef.current?.click()} className="control-button" style={{ flex: 1 }}>
                                            üìÅ Open File...
                                        </button>
                                    </div>
                                    
                                    {loadingStatus && (
                                        <div className="status-text" style={{ color: loadingStatus.includes('‚úó') ? '#CC0000' : loadingStatus.includes('‚úì') ? '#008800' : '#886600' }}>
                                            {loadingStatus}
                                        </div>
                                    )}
                                </div>
                                
                                <div className="status-text" style={{ textAlign: 'center', borderTop: '1px solid #999', paddingTop: '6px' }}>
                                    {isPlaying ? `‚ô™ Now Playing: ${trackName}` : 'Ready'}
                                </div>
                            </div>
                        </div>
                        
                        <audio ref={audioRef} src={audioSrc} loop />
                    </div>
                </div>
            );
        };

        ReactDOM.render(<WinXPVisualizer />, document.getElementById('root'));
    </script>
</body>
</html>
